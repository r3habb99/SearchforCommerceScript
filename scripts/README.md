# Scripts Directory Documentation

This directory contains specialized scripts that extend the Universal JSON to Commerce Format Converter with additional processing options, interactive interfaces, and file optimization capabilities.

## üéØ Scripts Overview

The scripts directory provides three main categories of functionality:

- **Interactive Conversion**: User-friendly interfaces for conversion with real-time options
- **File Optimization**: Post-processing utilities to reduce file sizes while maintaining data integrity
- **Results Analysis**: Comprehensive comparison and recommendation tools

## üìÅ Directory Structure

```
scripts/
‚îú‚îÄ‚îÄ conversion/                    # Interactive conversion scripts
‚îÇ   ‚îî‚îÄ‚îÄ convert_with_options.js    # Interactive conversion with optimization options
‚îú‚îÄ‚îÄ optimization/                  # File optimization and analysis scripts
‚îÇ   ‚îú‚îÄ‚îÄ optimize_output.js          # File size optimization utility
‚îÇ   ‚îî‚îÄ‚îÄ show_results.js            # Results display and comparison tool
‚îî‚îÄ‚îÄ README.md                      # This documentation file
```

## üîÑ Input/Output Flow

**Data Flow Summary:**

- **Input**: Scripts read JSON files from `Data/` folder (same as main converter)
- **Processing**: Scripts use `../../universal_converter.js` for core conversion logic
- **Output**: Scripts save optimized files to `optimized/` folder
- **Analysis**: Results scripts compare files between `output/` and `optimized/` folders

## üîß Conversion Scripts (`scripts/conversion/`)

### `convert_with_options.js` - Interactive Conversion

**Purpose**: Provides an interactive interface for conversion with real-time optimization selection.

#### Usage

```bash
npm run convert:options
```

#### Features

- **Interactive Menu**: Choose optimization level during conversion
- **Real-time Feedback**: See expected file sizes and processing time
- **Direct Output**: Saves optimized files directly to `optimized/` folder
- **Configuration Updates**: Dynamically adjusts settings based on user selection

#### Interactive Menu Example

```
üîß Interactive Conversion with Optimization Options
Choose your optimization level:
1. Full (no optimization) - Best search quality (~28KB/product)
2. Balanced (60% reduction) - Recommended for production (~11KB/product)
3. Compact (83% reduction) - Good for storage constraints (~5KB/product)
4. Minimal (88% reduction) - Basic search functionality (~3KB/product)

Selection: 2

‚úÖ Converting with balanced optimization...
üìä Expected output size: ~11KB per product
‚è±Ô∏è Estimated processing time: 15 seconds
```

#### Input/Output Relationship

- **Input Source**: JSON files from `Data/` folder
- **Processing**: Uses `../../universal_converter.js` with modified configuration
- **Output Destination**: Optimized JSONL files to `optimized/` folder
- **Integration**: Seamlessly integrates with main conversion pipeline

## ‚öôÔ∏è Optimization Scripts (`scripts/optimization/`)

### `optimize_output.js` - File Size Optimization

**Purpose**: Post-processing optimization utility that reduces file sizes while maintaining search functionality.

#### Usage Options

```bash
# Interactive mode with menu selection
npm run optimize

# Specific optimization levels
npm run optimize:minimal      # 88% size reduction (~3KB/product)
npm run optimize:balanced     # 60% size reduction (~11KB/product) - RECOMMENDED
npm run optimize:compact      # 83% size reduction (~5KB/product)
npm run optimize:compressed   # Gzip compression for maximum space savings
npm run optimize:all          # Generate all optimization versions at once
```

#### Optimization Levels Detailed

| Level | Size Reduction | File Size/Product | Search Quality | Use Case |
|-------|---------------|-------------------|----------------|----------|
| **Original** | 0% | ~28KB | Excellent | Development, best search results |
| **Balanced** | ~60% | ~11KB | Very Good | **Production deployment** |
| **Compact** | ~83% | ~5KB | Good | Storage-constrained environments |
| **Minimal** | ~88% | ~3KB | Basic | Basic search, minimal storage |
| **Compressed** | ~80% | ~6KB | Excellent | Archive/backup (requires decompression) |

#### Processing Logic

1. **Read Original Files**: Loads JSONL files from `output/` folder
2. **Apply Optimization Rules**: Removes or reduces fields based on optimization level
3. **Maintain Data Integrity**: Ensures all required fields for Vertex AI Commerce Search remain
4. **Write Optimized Files**: Saves to `optimized/` folder with descriptive naming
5. **Generate Reports**: Creates processing statistics and recommendations

#### Input/Output Relationship

- **Input Source**: JSONL files from `output/` folder (generated by main converter)
- **Processing**: Applies field reduction and compression algorithms
- **Output Destination**: Optimized JSONL files to `optimized/` folder
- **Naming Convention**: `{original_name}_{optimization_level}.jsonl`

### `show_results.js` - Results Display and Comparison

**Purpose**: Displays comprehensive comparison tables with actionable recommendations for production deployment.

#### Usage

```bash
npm run results
```

#### Features

- **File Size Comparisons**: Exact byte counts and reduction percentages
- **Production Recommendations**: Specific guidance for different deployment scenarios
- **Performance Impact Analysis**: Search quality vs. file size trade-offs
- **Next Steps Guidance**: Clear instructions for using optimized files

#### Sample Output

```
üìä CONVERSION RESULTS SUMMARY
============================================================
Original Files (output/):
  all_data_files_commerce_ready.jsonl: 106.8 MB (3,811 products)

Optimized Files (optimized/):
  all_data_files_commerce_ready_balanced.jsonl: 42.7 MB (60% reduction)
  all_data_files_commerce_ready_compact.jsonl: 18.1 MB (83% reduction)
  all_data_files_commerce_ready_minimal.jsonl: 12.8 MB (88% reduction)

üí° PRODUCTION RECOMMENDATIONS:
‚úÖ For Production: Use balanced version (60% reduction, excellent search quality)
üì¶ For Storage: Use minimal version (88% reduction, basic search functionality)
üóúÔ∏è For Archive: Use compressed version (requires decompression before use)

üéØ NEXT STEPS:
1. Copy recommended file to your Vertex AI Commerce Search import location
2. Update your import scripts to reference the optimized file path
3. Test search functionality with the optimized dataset
4. Monitor search performance and adjust optimization level if needed
```

## üîó Integration with Main Project

### Shared Dependencies

All scripts leverage the main project infrastructure:

- **Core Conversion Logic**: Uses `../../universal_converter.js` for all conversion operations
- **Configuration System**: Inherits settings from `constants/` directory
- **Error Handling**: Uses the same logging and error management systems
- **Performance Monitoring**: Shares memory monitoring and progress tracking

### NPM Scripts Integration

The scripts are integrated into the main project's NPM scripts:

```json
{
  "scripts": {
    "convert": "node universal_converter.js",
    "convert:options": "node scripts/conversion/convert_with_options.js",
    "optimize": "node scripts/optimization/optimize_output.js",
    "optimize:balanced": "node scripts/optimization/optimize_output.js balanced",
    "optimize:compact": "node scripts/optimization/optimize_output.js compact",
    "optimize:minimal": "node scripts/optimization/optimize_output.js minimal",
    "optimize:all": "node scripts/optimization/optimize_output.js all",
    "results": "node scripts/optimization/show_results.js"
  }
}
```

## üöÄ Usage Examples

### Example 1: Interactive Conversion Workflow

```bash
# Start with interactive conversion
npm run convert:options

# Choose optimization level interactively
# Files are automatically saved to optimized/ folder

# Review results
npm run results
```

### Example 2: Standard Conversion + Optimization Workflow

```bash
# Step 1: Run main conversion
npm run convert

# Step 2: Optimize for production
npm run optimize:balanced

# Step 3: Review and compare results
npm run results
```

### Example 3: Batch Optimization Workflow

```bash
# Run main conversion first
npm run convert

# Generate all optimization levels
npm run optimize:all

# Compare all versions
npm run results
```

## üéØ Best Practices

### When to Use Each Script

1. **Use `convert_with_options.js` when**:
   - You want immediate optimization during conversion
   - You're processing smaller datasets (< 1GB)
   - You want an interactive experience with real-time feedback

2. **Use `optimize_output.js` when**:
   - You want to keep original files and create optimized versions
   - You're processing large datasets where you want to preserve the original
   - You want to experiment with different optimization levels

3. **Use `show_results.js` when**:
   - You need to compare file sizes and make deployment decisions
   - You want detailed recommendations for production use
   - You're evaluating the trade-offs between file size and search quality

## üîß Troubleshooting

### Common Issues

1. **Script Not Found Errors**:

   ```bash
   # Ensure you're running from project root
   cd /path/to/SearchforCommerceScript
   npm run optimize:balanced
   ```

2. **Missing Input Files**:

   ```bash
   # Run main conversion first
   npm run convert
   # Then run optimization
   npm run optimize:balanced
   ```

3. **Permission Errors**:

   ```bash
   # Ensure write permissions for optimized/ directory
   chmod 755 optimized/
   ```

### Log Files

Scripts use the same logging system as the main converter:

- **General Logs**: `logs/conversion.log`
- **Error Logs**: `logs/errors.log`
- **Progress Tracking**: Real-time console output with progress bars
